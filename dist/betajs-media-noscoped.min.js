/*!
betajs-media - v0.0.1 - 2015-04-04
Copyright (c) Oliver Friedmann
MIT Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS.Media"),a.binding("base","global:BetaJS"),a.binding("jquery","global:jQuery"),a.define("module:",function(){return{guid:"8475efdb-dd7e-402e-9f50-36c76945a692",version:"6.1428181200851"}}),a.define("module:Player.Flash",["base:Flash.FlashClassRegistry","base:Flash.FlashEmbedding","base:Browser.Dom","base:Strings","base:Async","base:Ids","jquery:"],function(a,b,c,d,e,f,g){return{polyfill:function(a,b,d,f){return f?(e.eventually(function(){this.polyfill(a,b,d)},this),a):"video"==a.tagName.toLowerCase()&&"networkState"in a?a.networkState==a.NETWORK_NO_SOURCE||d?this.attach(c.changeTag(a,b||"videopoly")):a:this.attach(a)},__flashRegistrySingleton:function(){return this.__flashRegistry||(this.__flashRegistry=new a,this.__flashRegistry.register("flash.media.Video",["attachNetStream"]),this.__flashRegistry.register("flash.display.Sprite",["addChild"]),this.__flashRegistry.register("flash.display.Stage",[]),this.__flashRegistry.register("flash.net.NetStream",["play","addEventListener"]),this.__flashRegistry.register("flash.net.NetConnection",["connect","addEventListener"])),this.__flashRegistry},attach:function(a){var c=f.uniqueId("flashembedding"),h=g(a);h.css("display")&&"inline"!=h.css("display")||h.css("display","inline-block");for(var i=[".mp4",".flv"],j=[],k=0;k<a.childNodes.length;++k)a.childNodes[k].tagName&&"source"==a.childNodes[k].tagName.toLowerCase()&&a.childNodes[k].src&&j.push(a.childNodes[k].src.toLowerCase());var l=j[0],m=i.length-1;for(k=j.length-1;k>=0;--k)for(var n=0;m>=n;++n)if(d.ends_with(j[k],i[n])){l=j[k],m=n;break}-1==l.indexOf("://")&&(l=document.location.href+"/../"+l);var o=null,p=l;if(d.starts_with(l,"rtmp")){var q=d.splitLast(l,"/");o=q.head,p=q.tail}var r,s,t,u,v,w,x,y,z=new b(a,{registry:this.__flashRegistrySingleton(),wrap:!0}),A=function(){if(w){var b=h.width();h.width()<w.width&&!a.style.width&&(a.style.width=w.width+"px",b=h.width(),delete a.style.width);var c=Math.round(b*w.height/w.width);b!=x&&(x=b,y=c,h.find("object").css("width",x+"px"),h.find("embed").css("width",x+"px"),h.find("object").css("height",y+"px"),h.find("embed").css("height",y+"px"),t.set("width",x),t.set("height",y))}},B="idle";z.ready(function(){r=z.flashMain(),s=r.get("stage"),s.set("scaleMode","noScale"),s.set("align","TL"),t=z.newObject("flash.media.Video",s.get("stageWidth"),s.get("stageHeight")),r.addChildVoid(t),u=z.newObject("flash.net.NetConnection"),u.addEventListener("netStatus",z.newCallback(function(){v=z.newObject("flash.net.NetStream",u),v.set("client",z.newCallback("onMetaData",function(a){w=a,e.eventually(A)})),v.addEventListener("netStatus",z.newCallback(function(b){var c=b.get("info").code;"NetStream.Play.Start"==c&&(B="start"),"NetStream.Play.Stop"==c&&(B="stopping"),"NetStream.Buffer.Empty"==c&&"stopping"==B&&(B="stopped"),"stopped"==B&&a.attributes.loop&&(B="idle",a.play())})),t.attachNetStreamVoid(v),a.attributes.autoplay&&a.play()})),u.connectVoid(o)}),a.play=function(){v.playVoid(p)};var C=function(){g(window).off("."+c),g(document).off("."+c)};g(document).on("DOMNodeRemoved",function(b){b.target==a&&C()}),g(window).on("resize",A)}}})}).call(Scoped);