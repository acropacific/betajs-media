/*!
betajs-media - v0.0.1 - 2015-06-08
Copyright (c) Oliver Friedmann
MIT Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS.Media"),a.binding("base","global:BetaJS"),a.binding("jquery","global:jQuery"),a.define("module:",function(){return{guid:"8475efdb-dd7e-402e-9f50-36c76945a692",version:"8.1433781928579"}}),a.define("module:Player.Flash",["base:Browser.Dom","base:Async","module:Player.FlashPlayer"],function(a,b,c){return{polyfill:function(c,d,e,f){return f?(b.eventually(function(){this.polyfill(c,d,e)},this),c):"video"==c.tagName.toLowerCase()&&"networkState"in c?c.networkState==c.NETWORK_NO_SOURCE||e?this.attach(a.changeTag(c,d||"videopoly")):c:this.attach(c)},attach:function(a){new c(a);return a}}}),a.define("module:Player.FlashPlayer",["base:Class","base:Flash.FlashClassRegistry","base:Flash.FlashEmbedding","base:Strings","base:Async","base:Objs","base:Functions","jquery:"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},function(a){return{constructor:function(b){a.constructor.call(this),this._element=b,this._$element=h(b),this._currentWidth=null,this._currentHeight=null,this.__initCss(),this._source=this.__preferedSource(),this._embedding=new c(b,{registry:this.cls.flashRegistry(),wrap:!0}),this._flashObjs={},this._flashData={status:"idle"},this._embedding.ready(this.__initializeEmbedding,this),this.__initEvents(),f.iter(this.__elementMethods,function(a,b){this._element[b]=g.as_method(a,this)},this)},destroy:function(){h(window).off("."+this.cid()),h(document).off("."+this.cid()),this._embedding.destroy(),a.destroy.call(this)},__initEvents:function(){var a=this;h(document).on("DOMNodeRemoved."+this.cid(),function(b){b.target==a._element&&a.weakDestroy()}),h(window).on("resize",function(){a.updateSize()})},__initCss:function(){this._$element.css("display")&&"inline"!=this._$element.css("display")||this._$element.css("display","inline-block")},__preferedSource:function(){for(var a=[".mp4",".flv"],b=[],c=this._element,e=0;e<this._element.childNodes.length;++e)c.childNodes[e].tagName&&"source"==c.childNodes[e].tagName.toLowerCase()&&c.childNodes[e].src&&b.push(c.childNodes[e].src.toLowerCase());var f=b[0],g=a.length-1;for(e=b.length-1;e>=0;--e)for(var h=0;g>=h;++h)if(d.ends_with(b[e],a[h])){f=b[e],g=h;break}-1==f.indexOf("://")&&(f=document.location.href+"/../"+f);var i=null,j=f;if(d.starts_with(f,"rtmp")){var k=d.splitLast(f,"/");i=k.head,j=k.tail}return{sourceUrl:f,connectionUrl:i,playUrl:j}},__initializeEmbedding:function(){this._flashObjs.main=this._embedding.flashMain(),this._flashObjs.stage=this._flashObjs.main.get("stage"),this._flashObjs.stage.set("scaleMode","noScale"),this._flashObjs.stage.set("align","TL"),this._flashObjs.video=this._embedding.newObject("flash.media.Video",this._flashObjs.stage.get("stageWidth"),this._flashObjs.stage.get("stageHeight")),this._flashObjs.main.addChildVoid(this._flashObjs.video),this._flashObjs.connection=this._embedding.newObject("flash.net.NetConnection"),this._flashObjs.connection.addEventListener("netStatus",this._embedding.newCallback(g.as_method(this.__connectionStatusEvent,this))),this._flashObjs.connection.connectVoid(this._source.connectionUrl)},__connectionStatusEvent:function(){this._flashObjs.stream=this._embedding.newObject("flash.net.NetStream",this._flashObjs.connection),this._flashObjs.stream.set("client",this._embedding.newCallback("onMetaData",g.as_method(function(a){this._flashData.meta=a,e.eventually(this.updateSize,this)},this))),this._flashObjs.stream.addEventListener("netStatus",this._embedding.newCallback(g.as_method(this.__streamStatusEvent,this))),this._flashObjs.video.attachNetStreamVoid(this._flashObjs.stream),this._element.attributes.autoplay&&this._element.play()},__streamStatusEvent:function(a){var b=a.get("info").code;"NetStream.Play.Start"==b&&(this._flashData.status="start"),"NetStream.Play.Stop"==b&&(this._flashData.status="stopping"),"NetStream.Buffer.Empty"==b&&"stopping"==this._flashData.status&&(this._flashData.status="stopped"),"stopped"==this._flashData.status&&this._element.attributes.loop&&(this._flashData.status="idle",this._element.play())},updateSize:function(){if(this._flashData.meta){var a=this._$element,b=this._element,c=this._flashData.meta,d=a.width();a.width()<c.width&&!b.style.width&&(element.style.width=c.width+"px",d=a.width(),delete element.style.width);var e=Math.round(d*c.height/c.width);d!=this._currentWidth&&(this._currentWidth=d,this._currentHeight=e,a.find("object").css("width",this._currentWidth+"px"),a.find("embed").css("width",this._currentWidth+"px"),a.find("object").css("height",this._currentHeight+"px"),a.find("embed").css("height",this._currentHeight+"px"),this._flashObjs.video.set("width",this._currentWidth),this._flashObjs.video.set("height",this._currentHeight))}},__elementMethods:{play:function(){"paused"===this._flashData.status?this._flashObjs.stream.resumeVoid():this._flashObjs.stream.playVoid(this._source.playUrl)},pause:function(){this._flashObjs.stream.pauseVoid(),this._flashData.status="paused"},load:function(){this._flashObjs.stream.pauseVoid(),this._flashObjs.stream.set("seek",0),this._flashData.status="stopped"}}}},{flashRegistry:function(){return this.__flashRegistry||(this.__flashRegistry=new b,this.__flashRegistry.register("flash.media.Video",["attachNetStream"]),this.__flashRegistry.register("flash.display.Sprite",["addChild"]),this.__flashRegistry.register("flash.display.Stage",[]),this.__flashRegistry.register("flash.net.NetStream",["play","pause","resume","stop","addEventListener"]),this.__flashRegistry.register("flash.net.NetConnection",["connect","addEventListener"])),this.__flashRegistry}})})}).call(Scoped);